#include "gtest/gtest.h"
#include "raw_utils.hh"

TEST(RawUtils, BuildRawModeSFrame) {
    // Test with squitter packet.
    RawModeSPacket raw_packet = RawModeSPacket((char *)"2D0006A2DEE500", 3, -68, 9, 0xFEED'BEEF'BEFE'BEEB);

    char constructed_frame[kRawModeSFrameMaxNumChars];
    char *expected_frame = (char *)"#MDS*2D0006A2DEE500;(3,-68,9,FEEDBEEFBEFEBEEB)";
    EXPECT_EQ(BuildRawModeSFrame(raw_packet, constructed_frame), strlen(expected_frame));
    EXPECT_STREQ(expected_frame, constructed_frame);

    // Test with extended squitter packet.
    raw_packet = RawModeSPacket((char *)"8D48C22D60AB00DEABC5DB78FCD6", 1, -90, 3, 0xDEAD);
    expected_frame = (char *)"#MDS*8D48C22D60AB00DEABC5DB78FCD6;(1,-90,3,000000000000DEAD)";
    EXPECT_EQ(BuildRawModeSFrame(raw_packet, constructed_frame), strlen(expected_frame));
    EXPECT_STREQ(expected_frame, constructed_frame);
}

TEST(RawUtils, BuildRawUATFrame) {
    // Test with UAT long ADS-B packet.
    RawUATADSBPacket raw_packet =
        RawUATADSBPacket("00a66ef135445d525a0c05191190212048006cb82bc4d53a5b2bb0a8ec6e", -60, 5, 0x123456);

    char constructed_frame[kRawUATADSBFrameMaxNumChars];
    char *expected_frame =
        (char *)"#UAT*-00A66EF135445D525A0C05191190212048006CB82BC4D53A5B2BB0A8EC6E;(-60,5,0000000000123456)";
    EXPECT_EQ(BuildRawUATADSBFrame(raw_packet, constructed_frame), strlen(expected_frame));
    EXPECT_STREQ(expected_frame, constructed_frame);
}

TEST(RawUtils, BuildRawUATUplinkFrame) {
    // Test with UAT uplink packet.
    RawUATUplinkPacket raw_packet = RawUATUplinkPacket(
        "352d30000000147058000000c9c70d000000523c3c000000d61f170000005cc7f1000000b60cd7000000b01f0c0000002ec7720000000"
        "08cd3000000001f1e0000003505330000000ef6c10000001d5ffc000000687c7500000022f5c300000010d91c0000000020b400000000"
        "51cb00000000600c000000ff4cf000000000f57f00000051541c00000091227000000054037f0000007c4f1e0000004d053000000050f"
        "77c00000060de17000000cb00d90000004c337d0000007400f5000000d30015000000583549000000330e43000000d724050000005df0"
        "80000000b922d3000000c710c100000077007c000000f300d3000000c700c10000002dff810000003400540000007d5be00000000747c"
        "3000000cdc02c0000007c7c78000000f54dd5000000d950f500000020601500000051cb49000000604c430000004c7805000000f5cf80"
        "0000005408d30000002233c100000003d7b20000004f5e0000000005725a000000fccf78000000756700000000c3f6000000001cc3000"
        "00000b47c00000000c71f000000004d5d0000000035f3000000007f5f000000001d5100000000705400000000c7940000000028c30700"
        "00006495b5000000b5a39a000000d06df300000066d54d00000015e4e2000000fd19ca0000001534a70000007153d3000000ac0ea0000"
        "000c86953000000472843000000779764000000706f3b000000b006f30000009b356d0000000b0ee7000000ffc3ce00000049013f0000"
        "00964ddb000000",
        -60, 0, 0x00431a123456);

    char constructed_frame[kRawUATUplinkFrameMaxNumChars];
    char *expected_frame = (char *)"#UAT*+352D30000000147058000000C9C70D000000523C3C000000D61F170000005CC7F1000000B60CD7000000B01F0C0000002EC7720000000"
        "08CD3000000001F1E0000003505330000000EF6C10000001D5FFC000000687C7500000022F5C300000010D91C0000000020B400000000"
        "51CB00000000600C000000FF4CF000000000F57F00000051541C00000091227000000054037F0000007C4F1E0000004D053000000050F"
        "77C00000060DE17000000CB00D90000004C337D0000007400F5000000D30015000000583549000000330E43000000D724050000005DF0"
        "80000000B922D3000000C710C100000077007C000000F300D3000000C700C10000002DFF810000003400540000007D5BE00000000747C"
        "3000000CDC02C0000007C7C78000000F54DD5000000D950F500000020601500000051CB49000000604C430000004C7805000000F5CF80"
        "0000005408D30000002233C100000003D7B20000004F5E0000000005725A000000FCCF78000000756700000000C3F6000000001CC3000"
        "00000B47C00000000C71F000000004D5D0000000035F3000000007F5F000000001D5100000000705400000000C7940000000028C30700"
        "00006495B5000000B5A39A000000D06DF300000066D54D00000015E4E2000000FD19CA0000001534A70000007153D3000000AC0EA0000"
        "000C86953000000472843000000779764000000706F3B000000B006F30000009B356D0000000B0EE7000000FFC3CE00000049013F0000"
        "00964DDB000000;(-60,0,000000431A123456)";
    EXPECT_EQ(BuildRawUATUplinkFrame(raw_packet, constructed_frame), strlen(expected_frame));
    EXPECT_STREQ(expected_frame, constructed_frame);
}